<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="skymirror — see what the sky feels like today">
    <meta name="theme-color" content="#FFFFFF">
    
    <title>skymirror ☁︎ — Sky Explorer</title>
    
    <!-- PWA -->
    <link rel="manifest" href="/manifest.json">
    <link rel="apple-touch-icon" href="/icons/icon-192.png">
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans:wght@200;300;400;500&family=Space+Grotesk:wght@300;400;500;600&display=swap" rel="stylesheet">
    
    <!-- Styles -->
    <link rel="stylesheet" href="/styles/main.css">
    <style>
        @keyframes fadeIn {
          from { opacity: 0; transform: translateY(20px); }
          to { opacity: 1; transform: translateY(0); }
        }
        
        #onboardingScreen {
          position: fixed;
          top: 0;
          left: 0;
          width: 100%;
          height: 100%;
          background: white;
          z-index: 10000;
          display: flex;
          align-items: center;
          justify-content: center;
          padding: 2rem;
          overflow-y: auto;
        }
        
        #onboardingContent {
          width: 100%;
          max-width: 900px;
        }
        
        .onboarding-btn {
          padding: 1.25rem 2.5rem;
          background: black;
          color: white;
          border: 2px solid black;
          border-radius: 12px;
          font-size: 1.2rem;
          font-weight: 500;
          cursor: pointer;
          transition: all 0.3s ease;
          margin: 0.5rem;
        }
        
        .onboarding-btn:hover {
          background: white;
          color: black;
          transform: translateY(-2px);
          box-shadow: 0 8px 16px rgba(0,0,0,0.1);
        }
        
        .onboarding-btn-skip {
          padding: 0.75rem 1.5rem;
          background: white;
          color: black;
          border: 1px solid rgba(0,0,0,0.2);
          border-radius: 8px;
          font-size: 0.95rem;
          cursor: pointer;
          transition: all 0.3s ease;
          margin: 0.5rem;
          opacity: 0.6;
        }
        
        .onboarding-btn-skip:hover {
          opacity: 1;
          border-color: black;
        }
        
        .feature-preview {
          padding: 1.5rem;
          border: 1px solid rgba(0,0,0,0.1);
          border-radius: 8px;
          transition: all 0.3s ease;
        }
        
        .feature-preview:hover {
          background: rgba(163, 196, 243, 0.05);
          transform: translateY(-4px);
        }
        
        #mainApp {
          display: none;
        }
    </style>
</head>
<body>
    <!-- Onboarding Screen -->
    <div id="onboardingScreen">
        <div id="onboardingContent"></div>
    </div>

    <!-- Main App (Hidden Until Onboarding Complete) -->
    <div id="mainApp">
    <!-- Header -->
    <header class="header">
        <div class="logo">
            <span>skymirror</span>
            <span>☁︎</span>
        </div>
        
        <div class="header-icons">
            <button class="icon-btn" id="settingsBtn" aria-label="Settings" title="Settings">⚙️</button>
            <button class="icon-btn" id="ritualBtn" aria-label="Daily Ritual" title="Daily Ritual">🕊️</button>
            <button class="icon-btn" id="notesBtn" aria-label="Notes" title="View Reflections">📜</button>
            <button class="icon-btn" onclick="localStorage.removeItem('skyMirrorOnboarding'); location.reload();" aria-label="Restart Tutorial" title="Restart Tutorial">📖</button>
            <a href="/game.html" class="icon-btn" title="Aurora Catcher Game">🎮</a>
        </div>
    </header>

    <!-- Main Dashboard -->
    <main class="dashboard grid-bg">
        <div class="dashboard-grid">
            
            <!-- Current Scene Card -->
            <div class="weather-card card-illustration fade-in" style="animation-delay: 0s;">
                <div class="card-header">
                    <h2 class="card-title">✨ Your Sky Right Now</h2>
                </div>
                <div id="weatherScene" style="width: 100%; min-height: 300px; max-height: 400px; display: flex; align-items: center; justify-content: center; border: 1px dashed rgba(0,0,0,0.1); border-radius: 8px; background: rgba(0,0,0,0.01); overflow: hidden;">
                    <!-- SVG scene will load here via stars.js -->
                    <svg viewBox="0 0 800 400" xmlns="http://www.w3.org/2000/svg" style="width: 100%; height: auto; max-height: 400px;">
                        <text x="400" y="200" font-size="16" fill="#000" text-anchor="middle" opacity="0.5">Loading scene...</text>
                    </svg>
                </div>
                <p class="card-description" style="margin-top: 1rem;">✨ Click on the stars, Sun, Moon, and planets to learn their amazing stories!</p>
            </div>
            
            <!-- Wind Card -->
            <div class="weather-card card-wind fade-in" style="animation-delay: 0.1s;">
                <div class="card-header">
                    <div class="card-icon" id="windIcon"></div>
                    <h2 class="card-title">🌬️ Wind Speed</h2>
                </div>
                <div class="card-value" id="windValue">—</div>
                <p class="card-description" id="windDescription">—</p>
            </div>
            
            <!-- Temperature Card -->
            <div class="weather-card card-temp fade-in" style="animation-delay: 0.2s;">
                <div class="card-header">
                    <div class="card-icon" id="tempIcon"></div>
                    <h2 class="card-title">🌡️ How Hot or Cold?</h2>
                </div>
                <div class="card-value" id="tempValue">—</div>
                <p class="card-description" id="tempDescription">—</p>
            </div>
            
            <!-- Air Quality Card -->
            <div class="weather-card card-air fade-in" style="animation-delay: 0.3s;">
                <div class="card-header">
                    <div class="card-icon" id="airIcon"></div>
                    <h2 class="card-title">🍃 Air Quality</h2>
                </div>
                <div class="card-value" id="airValue">—</div>
                <p class="card-description" id="airDescription">—</p>
            </div>
            
            <!-- Sky Condition Card -->
            <div class="weather-card card-sky fade-in" style="animation-delay: 0.4s;">
                <div class="card-header">
                    <div class="card-icon" id="skyIcon"></div>
                    <h2 class="card-title">☁️ Clouds & Weather</h2>
                </div>
                <div class="card-value" id="skyValue">—</div>
                <p class="card-description" id="skyDescription">—</p>
            </div>
            
            <!-- Humidity & Pressure Card -->
            <div class="weather-card card-extra fade-in" style="animation-delay: 0.5s;">
                <div class="card-header">
                    <h2 class="card-title">💧 Humidity & Air Pressure</h2>
                </div>
                <div style="display: flex; justify-content: space-between; margin-bottom: 1rem;">
                    <div>
                        <div class="card-value" id="humidityValue" style="font-size: 1.8rem;">—</div>
                        <p class="card-description" id="humidityDescription">How humid?</p>
                    </div>
                    <div style="text-align: right;">
                        <div class="card-value" id="pressureValue" style="font-size: 1.8rem;">—</div>
                        <p class="card-description">Air pressure</p>
                    </div>
                </div>
                <p class="card-description">How far can you see? <span id="visibilityValue">—</span></p>
            </div>
            
            <!-- Sun & Moon Card -->
            <div class="weather-card card-extra fade-in" style="animation-delay: 0.6s;">
                <div class="card-header">
                    <div class="card-icon">
                        <svg viewBox="0 0 48 48" id="sunMoonIcon">
                            <circle cx="24" cy="24" r="12" fill="none" stroke="#000" stroke-width="2"/>
                        </svg>
                    </div>
                    <h2 class="card-title">☀️ Day or Night?</h2>
                </div>
                <div class="card-value" id="dayNightValue">—</div>
                <p class="card-description" id="sunMoonDescription">—</p>
            </div>
            
            <!-- Aurora Activity Card -->
            <div class="weather-card card-aurora fade-in" style="animation-delay: 0.7s;">
                <div class="card-header">
                    <div class="card-icon">
                        <svg viewBox="0 0 48 48">
                            <path d="M 10 30 Q 18 20 24 25 Q 30 20 38 30" fill="none" stroke="#A3C4F3" stroke-width="2"/>
                            <path d="M 12 35 Q 20 25 24 30 Q 28 25 36 35" fill="none" stroke="#B5EAD7" stroke-width="2"/>
                            <path d="M 14 40 Q 22 30 24 35 Q 26 30 34 40" fill="none" stroke="#C8BFE7" stroke-width="2"/>
                        </svg>
                    </div>
                    <h2 class="card-title">🌌 Northern Lights Tracker</h2>
                </div>
                <div class="card-value" id="auroraValue">—</div>
                <p class="card-description" id="auroraDescription">—</p>
                <div id="auroraViz" style="width: 100%; height: 120px; margin-top: 1rem;"></div>
            </div>
            
            <!-- Moon Phase Card -->
            <div class="weather-card card-moon fade-in" style="animation-delay: 0.8s;">
                <div class="card-header">
                    <h2 class="card-title">🌙 Moon Shape Today</h2>
                </div>
                <div id="moonPhaseViz" style="width: 100%; height: 120px; display: flex; align-items: center; justify-content: center; border: 1px dashed rgba(0,0,0,0.1); border-radius: 8px; background: rgba(0,0,0,0.01);">
                    <!-- Moon SVG will load here -->
                    <svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg" style="width: 100px; height: 100px;">
                      <circle cx="50" cy="50" r="40" fill="none" stroke="#000" stroke-width="2"/>
                      <text x="50" y="55" font-size="12" fill="#000" text-anchor="middle">Loading...</text>
                    </svg>
                </div>
                <p class="card-description" id="moonDescription">Calculating phase...</p>
            </div>
            
            <!-- Sky Soundscape Card -->
            <div class="weather-card card-sound fade-in" style="animation-delay: 0.9s;">
                <div class="card-header">
                    <div class="card-icon">
                        <svg viewBox="0 0 48 48">
                            <path d="M 15 18 L 15 30 L 10 30 L 18 38 L 26 30 L 21 30 L 21 18 Z" fill="none" stroke="#000" stroke-width="1.5"/>
                            <path d="M 28 20 Q 32 24 28 28" fill="none" stroke="#000" stroke-width="1.5"/>
                            <path d="M 33 17 Q 38 24 33 31" fill="none" stroke="#000" stroke-width="1.5"/>
                        </svg>
                    </div>
                    <h2 class="card-title">🎵 Sounds of the Sky</h2>
                </div>
                <p class="card-description">🎵 Hear what the sky sounds like! Wind, rain, and space!</p>
                <div style="display: flex; gap: 0.75rem; margin-top: 1rem;">
                    <button class="btn btn-primary" id="playSoundBtn" style="flex: 1; padding: 0.75rem;">
                        ▶ Play
                    </button>
                    <button class="btn" id="stopSoundBtn" style="flex: 1; padding: 0.75rem;">
                        ⏹ Stop
                    </button>
                </div>
                <p class="card-description" id="soundDescription" style="margin-top: 0.75rem; font-size: 0.85rem;">
                    Close your eyes and listen to the weather music!
                </p>
            </div>
            
            <!-- Did You Know Card -->
            <div class="weather-card card-extra fade-in" style="animation-delay: 1s;">
                <div class="card-header">
                    <div class="card-icon">💡</div>
                    <h2 class="card-title">💡 Cool Space Facts!</h2>
                </div>
                <p class="card-description" id="funFact" style="line-height: 1.8; font-size: 1rem;">
                    Loading a cool space fact just for you...
                </p>
            </div>
            
            <!-- Perspectives Card -->
            <div class="weather-card card-extra fade-in" style="animation-delay: 1.1s; grid-column: 1 / -1;">
                <div class="card-header">
                    <div class="card-icon">👥</div>
                    <h2 class="card-title">🌍 Real People, Real Stories</h2>
                </div>
                <div id="perspectiveCard" style="cursor: pointer; padding: 1.5rem; background: rgba(163, 196, 243, 0.05); border-radius: 8px; border: 1px dashed rgba(0,0,0,0.1);">
                    <div style="font-size: 2rem; margin-bottom: 0.5rem;" id="perspectiveEmoji">👨‍🌾</div>
                    <h3 style="font-size: 1.3rem; margin-bottom: 0.75rem;" id="perspectiveCharacter">Loading...</h3>
                    <p style="font-size: 0.95rem; opacity: 0.7; margin-bottom: 1rem;" id="perspectiveTitle">How space weather affects different people</p>
                    <p style="line-height: 1.8; font-size: 1rem; white-space: pre-line;" id="perspectiveStory">Click to read a story...</p>
                    <button class="btn" onclick="window.loadNewPerspective()" style="margin-top: 1rem; padding: 0.75rem 1.5rem;">
                        🔄 Read Another Story
                    </button>
                </div>
            </div>
            
        </div>
        
        <!-- 24-Hour Timeline -->
        <div id="timeline" style="margin-top: 3rem; padding: 2rem; background: white; border: 1px solid black; border-radius: 12px; max-width: 1400px; margin-left: auto; margin-right: auto;"></div>
    </main>

    <!-- Loading -->
    <div class="loading hidden" id="loading">
        <svg class="loading-cloud" viewBox="0 0 80 80">
            <path d="M 20 40 Q 20 30 30 30 Q 35 20 45 25 Q 55 20 60 30 Q 70 30 70 40 Q 70 50 60 50 L 30 50 Q 20 50 20 40 Z" 
                  fill="none" stroke="#000" stroke-width="2"/>
        </svg>
    </div>

    <!-- Settings Modal -->
    <div id="settingsModal" class="modal">
        <div class="modal-content">
            <button class="modal-close" id="closeSettings">×</button>
            <h2>Settings</h2>
            <div style="margin-top: 2rem;">
                <label style="display: block; margin-bottom: 0.5rem;">Temperature Unit:</label>
                <select id="tempUnit" class="input">
                    <option value="C">Celsius (°C)</option>
                    <option value="F">Fahrenheit (°F)</option>
                </select>
            </div>
            <div style="margin-top: 1.5rem;">
                <label style="display: flex; align-items: center; gap: 0.5rem;">
                    <input type="checkbox" id="autoRitual" checked>
                    <span>Show daily ritual prompt</span>
                </label>
            </div>
            <div style="margin-top: 1.5rem;">
                <button class="btn" onclick="localStorage.removeItem('skyMirrorOnboarding'); location.reload();" style="width: 100%;">
                    📖 Restart Welcome Tutorial
                </button>
            </div>
        </div>
    </div>

    <!-- Ritual Modal -->
    <div id="ritualModal" class="modal">
        <div class="modal-content">
            <button class="modal-close" id="cancelRitual">×</button>
            <h2>What did the sky feel like today?</h2>
            <textarea id="ritualText" class="textarea" placeholder="Write your thoughts, feelings, or observations about today's sky..."></textarea>
            <button class="btn btn-primary" id="saveRitual">Save Reflection</button>
        </div>
    </div>

    <!-- Notes Modal -->
    <div id="notesModal" class="modal">
        <div class="modal-content">
            <button class="modal-close" id="closeNotes">×</button>
            <h2>Your Reflections</h2>
            <div id="notesList" style="margin-top: 2rem; max-height: 400px; overflow-y: auto;"></div>
        </div>
    </div>

    <!-- Star Details Modal -->
    <div id="starModal" class="modal">
        <div class="modal-content" style="max-width: 700px;">
            <button class="modal-close" onclick="document.getElementById('starModal').classList.remove('active')">×</button>
            <h2 id="starModalTitle">Star Details</h2>
            <div id="starModalContent" style="margin-top: 1.5rem; line-height: 1.8;"></div>
        </div>
    </div>

    </div>
    <!-- End Main App -->

    <!-- Scripts -->
    <script src="/js/weather.js"></script>
    <script src="/js/aurora.js"></script>
    <script src="/js/moon.js"></script>
    <script src="/js/soundscape.js"></script>
    <script src="/js/icons.js"></script>
    <script src="/js/stars.js"></script>
    <script src="/js/perspectives.js"></script>
    <script src="/js/onboarding.js"></script>
    <script src="/js/app.js"></script>
    
    <!-- Start onboarding or main app -->
    <script>
      // Wrap the main app initialization
      window.skyMirrorInit = function() {
        if (!window.skyMirror) {
          window.skyMirror = new SkyMirror();
        }
      };
      
      // Start onboarding flow
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', () => {
          window.initOnboarding();
        });
      } else {
        window.initOnboarding();
      }
    </script>
</body>
</html>
